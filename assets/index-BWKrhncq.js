import{r as c,c as P,H as B,o as F,w as S,a as d,b as h,I as N,J as O,y as I,d as W,z as C}from"./index-JqDeAB-5.js";const q=n=>{const e=[];return n.forEach(o=>{e.push(...o.getElementsByTagName("img"))}),e},K=n=>n.map(e=>e.src),z=n=>{const e=[];return n.forEach((o,s)=>{e[s]=new Promise((f,m)=>{const u=new Image;u.src=o,u.onload=()=>{f({img:o,index:s})}})}),Promise.all(e)},_=n=>{const e=Object.values(n);return Math.min(...e)},R=n=>{const e=Object.values(n);return Math.max(...e)},b=n=>{const e=_(n);return Object.keys(n).find(o=>n[o]===e)},J={key:1},$={__name:"index",props:{data:{type:Array,Required:!0},nodeKey:{type:String},column:{default:2,type:Number},columnSpacing:{default:20,type:Number},rowSpacing:{default:20,type:Number},picturePreloading:{type:Boolean,default:!1}},setup(n){const e=n,o=c(0),s=c({}),f=()=>{for(let t=0;t<e.column;t++)s.value[t]=0},m=c(null),u=c(0),p=c(0),k=()=>{const t=getComputedStyle(m.value,null),{paddingLeft:a,paddingRight:l}=t;p.value=parseFloat(a),u.value=m.value.offsetWidth-parseFloat(a)-parseFloat(l)},r=c(0),x=P(()=>(e.column-1)*e.columnSpacing),y=()=>(k(),r.value=(u.value-x.value)/e.column);B(()=>{y()});let i=[];const A=async()=>{i=[];let t=[...document.querySelectorAll(".m-waterfall-item")];const a=q(t),l=K(a);await z(l).then(()=>{t.forEach(g=>{i.push(g.offsetHeight)}),v()})},T=()=>{i=[],[...document.querySelectorAll(".m-waterfall-item")].forEach(a=>{i.push(a.offsetHeight)}),v()},v=()=>{e.data.forEach((t,a)=>{t._style||(t._style={},t._style.left=L(),t._style.top=M(),j(a))}),o.value=R(s.value)};F(()=>{e.data.forEach(t=>{delete t._style})});const L=()=>b(s.value)*(r.value+e.columnSpacing)+p.value,M=()=>_(s.value),j=t=>{const a=b(s.value);s.value[a]+=i[t]+e.rowSpacing};S(()=>e.data,t=>{C(()=>{t.every(l=>!l._style)&&f(),e.picturePreloading?A():T()})},{deep:!0,immediate:!0});const H=()=>{setTimeout(()=>{y(),e.data.forEach(t=>{t._style=null})},100)};return S(()=>e.column,()=>{e.picturePreloading?(r.value=0,C(H())):H()}),(t,a)=>(h(),d("div",{class:"relative",ref_key:"containerTarget",ref:m,style:I({height:o.value+"px"})},[r.value&&n.data.length?(h(!0),d(N,{key:0},O(n.data,(l,g)=>{var w,E;return h(),d("div",{key:n.nodeKey?l[n.nodeKey]:g,class:"m-waterfall-item absolute duration-300",style:I({width:r.value+"px",left:((w=l._style)==null?void 0:w.left)+"px",top:((E=l._style)==null?void 0:E.top)+"px"})},[W(t.$slots,"waterfall",{item:l,width:r.value,index:g})],4)}),128)):(h(),d("div",J,"LoadingÔºÅ"))],4))}};export{$ as default};
